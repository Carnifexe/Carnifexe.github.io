<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultimate Pong | carnifexe-github-io.onrender.com</title>
  <style>
    :root {
      --primary: #4CAF50;
      --secondary: #2E7D32;
      --accent: #FFC107;
      --background: #121212;
      --surface: #1E1E1E;
      --error: #CF6679;
      --text-primary: #FFFFFF;
      --text-secondary: rgba(255, 255, 255, 0.7);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
      width: 100%;
    }

    h1 {
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 2.5rem;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    #gameContainer {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 800px;
    }

    #connectionStatus {
      padding: 12px 20px;
      border-radius: 8px;
      margin: 10px 0;
      width: 100%;
      max-width: 800px;
      text-align: center;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .online {
      background-color: var(--secondary);
      border-left: 5px solid var(--primary);
    }

    .offline {
      background-color: #5c2a2a;
      border-left: 5px solid var(--error);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    #scoreBoard {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 800px;
      margin: 10px 0;
      font-size: 1.5rem;
      font-weight: bold;
      background: var(--surface);
      padding: 10px 20px;
      border-radius: 8px;
    }

    #leftScore, #rightScore {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #gameCanvas {
      background: #000;
      border: 2px solid var(--surface);
      display: block;
      width: 800px;
      height: 600px;
      margin: 10px 0;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      touch-action: none;
    }

    #playersPanel {
      width: 100%;
      max-width: 800px;
      margin: 20px 0;
      background: var(--surface);
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    #playersPanel h2 {
      color: var(--accent);
      margin-bottom: 15px;
      font-size: 1.5rem;
    }

    #playerList {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #playerList li {
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    #playerList li.playing {
      background-color: rgba(76, 175, 80, 0.1);
      border-left: 3px solid var(--primary);
    }

    #playerList li.empty {
      text-align: center;
      color: var(--text-secondary);
      font-style: italic;
    }

    #playButton {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.2s ease;
    }

    #playButton:hover {
      background-color: var(--secondary);
      transform: translateY(-2px);
    }

    #gameInfo {
      margin-top: 15px;
      font-size: 0.9rem;
      color: var(--accent);
      text-align: center;
      padding: 10px;
      border-radius: 5px;
      background-color: rgba(255, 193, 7, 0.1);
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2rem;
      }
      
      #gameCanvas {
        width: 100%;
        height: 400px;
      }
      
      #scoreBoard {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Ultimate Pong</h1>
    <div id="connectionStatus">üü° Verbinde mit Server...</div>
  </header>

  <main id="gameContainer">
    <div id="scoreBoard">
      <div id="leftScore"><span id="leftPlayerName">Du</span>: <span>0</span></div>
      <div id="rightScore"><span id="rightPlayerName">Gegner</span>: <span>0</span></div>
    </div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <section id="playersPanel">
      <h2>Spielstatus</h2>
      <ul id="playerList">
        <li class="empty">Verbinde mit Server...</li>
      </ul>
      <button id="playButton">Jetzt spielen</button>
      <div id="gameInfo">Bereit f√ºr ein Spiel?</div>
    </section>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // DOM Elemente
      const gameCanvas = document.getElementById('gameCanvas');
      const ctx = gameCanvas.getContext('2d');
      const playerList = document.getElementById('playerList');
      const connectionStatus = document.getElementById('connectionStatus');
      const playButton = document.getElementById('playButton');
      const gameInfo = document.getElementById('gameInfo');
      const leftScore = document.getElementById('leftScore').querySelector('span:last-child');
      const rightScore = document.getElementById('rightScore').querySelector('span:last-child');
      const leftPlayerName = document.getElementById('leftPlayerName');
      const rightPlayerName = document.getElementById('rightPlayerName');

      // Spielzustand
      const gameState = {
        leftPaddle: { y: 50, width: 15, height: 100 },
        rightPaddle: { y: 50, width: 15, height: 100 },
        ball: { x: 50, y: 50, radius: 8 },
        scores: { left: 0, right: 0 },
        currentGame: null,
        playerSide: null,
        opponentName: '',
        lastUpdate: Date.now(),
        gameActive: false
      };

      // Socket.io Verbindung
      const socket = io('wss://carnifexe-github-io.onrender.com', {
        transports: ['websocket']
      });

      // Verbindungsstatus
      socket.on('connect', () => {
        connectionStatus.innerHTML = 'üü¢ ONLINE';
        connectionStatus.className = 'online';
        gameInfo.textContent = 'Bereit f√ºr ein Spiel!';
      });

      socket.on('disconnect', () => {
        connectionStatus.innerHTML = 'üî¥ OFFLINE';
        connectionStatus.className = 'offline';
        gameInfo.textContent = 'Verbindung verloren';
      });

      // Spielstart
      socket.on('game_start', (data) => {
        gameState.currentGame = data.gameId;
        gameState.playerSide = data.playerSide;
        gameState.opponentName = data.opponentName;
        gameState.gameActive = true;
        
        if (gameState.playerSide === 'left') {
          leftPlayerName.textContent = 'Du';
          rightPlayerName.textContent = data.opponentName;
        } else {
          leftPlayerName.textContent = data.opponentName;
          rightPlayerName.textContent = 'Du';
        }
        
        playerList.innerHTML = `
          <li class="playing">
            Gegen ${data.opponentName}
            <span class="status">(${gameState.playerSide === 'left' ? 'Links' : 'Rechts'})</span>
          </li>
        `;
        
        gameCanvas.style.cursor = 'none';
        gameInfo.textContent = 'Spiel l√§uft!';
        render();
      });

      // Spielupdate vom Gegner
      socket.on('game_update', (data) => {
        if (data.isOpponent) {
          if (gameState.playerSide === 'left') {
            gameState.rightPaddle.y = data.paddleY;
          } else {
            gameState.leftPaddle.y = data.paddleY;
          }
          
          if (data.ball) {
            gameState.ball = data.ball;
          }
          
          if (data.scores) {
            gameState.scores = data.scores;
            leftScore.textContent = gameState.scores.left;
            rightScore.textContent = gameState.scores.right;
          }
        }
      });

      // Spielende
      socket.on('game_ended', (data) => {
        gameState.currentGame = null;
        gameState.gameActive = false;
        gameCanvas.style.cursor = 'default';
        
        if (data && data.reason === 'opponent_disconnected') {
          playerList.innerHTML = '<li class="empty">Gegner hat das Spiel verlassen!</li>';
          gameInfo.textContent = 'Spiel beendet';
        }
      });

      // Spielen-Button
      playButton.addEventListener('click', () => {
        if (socket.connected) {
          const playerName = prompt('W√§hle deinen Spielernamen:', `Spieler_${Math.floor(Math.random()*1000)}`);
          if (playerName) {
            socket.emit('join_queue', playerName);
            playerList.innerHTML = '<li class="empty">Suche nach Gegner...</li>';
            gameInfo.textContent = 'Warte auf Gegner...';
          }
        } else {
          alert('Keine Serververbindung!');
        }
      });

      // Paddle Bewegung
      gameCanvas.addEventListener('mousemove', (e) => {
        if (!gameState.gameActive) return;
        
        const rect = gameCanvas.getBoundingClientRect();
        const y = ((e.clientY - rect.top) / gameCanvas.height) * 100;
        
        if (gameState.playerSide === 'left') {
          gameState.leftPaddle.y = y;
        } else {
          gameState.rightPaddle.y = y;
        }
        
        socket.emit('game_update', {
          gameId: gameState.currentGame,
          paddleY: y
        });
      });

      // Touch-Support
      gameCanvas.addEventListener('touchmove', (e) => {
        if (!gameState.gameActive) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        const rect = gameCanvas.getBoundingClientRect();
        const y = ((touch.clientY - rect.top) / gameCanvas.height) * 100;
        
        if (gameState.playerSide === 'left') {
          gameState.leftPaddle.y = y;
        } else {
          gameState.rightPaddle.y = y;
        }
        
        socket.emit('game_update', {
          gameId: gameState.currentGame,
          paddleY: y
        });
      });

      // Render-Funktion
      function render() {
        if (!gameState.gameActive) return;
        
        // Hintergrund
        ctx.fillStyle = '#111';
        ctx.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
        
        // Mittellinie
        ctx.setLineDash([15, 15]);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(gameCanvas.width/2, 0);
        ctx.lineTo(gameCanvas.width/2, gameCanvas.height);
        ctx.stroke();
        ctx.setLineDash([]);
        
        // Schl√§ger
        ctx.fillStyle = '#FFF';
        // Linker Schl√§ger
        ctx.fillRect(
          20, 
          (gameState.leftPaddle.y/100)*gameCanvas.height - gameState.leftPaddle.height/2, 
          gameState.leftPaddle.width, 
          gameState.leftPaddle.height
        );
        // Rechter Schl√§ger
        ctx.fillRect(
          gameCanvas.width - 20 - gameState.rightPaddle.width, 
          (gameState.rightPaddle.y/100)*gameCanvas.height - gameState.rightPaddle.height/2, 
          gameState.rightPaddle.width, 
          gameState.rightPaddle.height
        );
        
        // Ball
        ctx.beginPath();
        ctx.arc(
          (gameState.ball.x/100)*gameCanvas.width,
          (gameState.ball.y/100)*gameCanvas.height,
          gameState.ball.radius,
          0,
          Math.PI*2
        );
        ctx.fill();
        
        requestAnimationFrame(render);
      }
    });
  </script>
</body>
</html>
